(("undefined"!==typeof self?self:this)["webpackJsonpgestionTache"]=("undefined"!==typeof self?self:this)["webpackJsonpgestionTache"]||[]).push([[2],{"2a5d":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{"check-valid-form":t.checkForSave}},[a("div",[a("CRow",{staticClass:"form-group",attrs:{gutters:!1}},[a("br"),a("CCol",{attrs:{sm:"3"}},[a("p",[t._v("Choisir un type:")])]),a("CCol",{attrs:{sm:"9"}},[a("CInputRadioGroup",{attrs:{options:t.options,checked:t.postData.type,custom:"",inline:""},on:{"update:checked":function(e){return t.$set(t.postData,"type",e)}}}),t.postData.type.length<2?a("small",{staticClass:"text-danger"},[t._v(" Ce champ est requis ")]):t._e()],1)],1)],1),a("hr"),a("div",{staticClass:"pl-sm-2"},["memos"!==t.postData.type&&""===t.postData.date_fin_reel?a("CRow",{staticClass:"form-group",attrs:{gutters:!1}},[a("CCol",{attrs:{sm:"2"}},[a("p",[t._v("Statut:")])]),a("CCol",{attrs:{sm:"10"}},[a("CInputRadioGroup",{attrs:{options:t.statusOpt,checked:t.postData.status,custom:"",inline:""},on:{"update:checked":function(e){return t.$set(t.postData,"status",e)}}})],1),t.showInputRaison?a("CCol",{attrs:{sm:"8",md:"7"}},[a("CTextarea",{attrs:{label:"Raison:",type:"textarea",horizontal:"",placeholder:"writes something...",rows:"2",description:"Une description de la raison du changement de status"},model:{value:t.postData.raison,callback:function(e){t.$set(t.postData,"raison",e)},expression:"postData.raison"}})],1):t._e()],1):t._e(),"memos"!==t.postData.type?a("CRow",[a("CCol",{attrs:{col:"12",lg:"6"}},[a("CRow",{},[a("CInput",{staticClass:"col-10 col-sm-7",attrs:{label:"Debut:",type:"date",readonly:t.postData.date_fin_reel>0,horizontal:""},model:{value:t.postData.date_depart_proposer,callback:function(e){t.$set(t.postData,"date_depart_proposer",e)},expression:"postData.date_depart_proposer"}}),a("CInput",{staticClass:"col-8 ml-sm-0 pl-sm-0 col-sm-5",attrs:{readonly:t.postData.date_fin_reel>0,type:"time",horizontal:""},model:{value:t.postData.heure_debut,callback:function(e){t.$set(t.postData,"heure_debut",e)},expression:"postData.heure_debut"}})],1)],1),a("CCol",{attrs:{col:"10",lg:"6"}},[a("CRow",{},[a("CInput",{staticClass:"col-10 col-sm-7",attrs:{label:"Fin:",readonly:t.postData.date_fin_reel>0,type:"date",horizontal:""},model:{value:t.postData.date_fin_proposer,callback:function(e){t.$set(t.postData,"date_fin_proposer",e)},expression:"postData.date_fin_proposer"}}),a("CInput",{staticClass:"col-8 ml-sm-0 pl-sm-0 col-sm-5",attrs:{readonly:t.postData.date_fin_reel>0,type:"time",horizontal:""},model:{value:t.postData.heure_fin,callback:function(e){t.$set(t.postData,"heure_fin",e)},expression:"postData.heure_fin"}})],1)],1)],1):t._e(),a("CRow",[a("CCol",{staticClass:"d-flex",attrs:{sm:"10"}},[a("div",{staticClass:"form-group d-flex align-items-center"},[a("span",{staticClass:"pr-3 d-block"},[t._v(" Contenu privée ? ")]),a("CSwitch",{staticClass:"mr-1",attrs:{color:"danger",shape:"pill",checked:t.postData.privaty,size:"sm"},on:{"update:checked":function(e){return t.$set(t.postData,"privaty",e)}}})],1)]),a("CCol",{attrs:{sm:"10"}},[a("div",{staticClass:"form-group d-none"},[t._v(" Assigné : "),a("pre",[t._v(" "+t._s(t.postData)+" ")]),t._v(" formValues : "),a("pre",[t._v(" "+t._s(t.formValues)+" ")])])]),a("CCol",{attrs:{sm:"7"}},[a("CInput",{attrs:{label:"Title:",placeholder:"Entrez un titre",wasValidated:t.wasValidated,validFeedback:"ok",invalidFeedback:"requis",isValid:t.inputValidation},model:{value:t.postData.titre,callback:function(e){t.$set(t.postData,"titre",e)},expression:"postData.titre"}})],1),"project"==t.postData.type?a("CCol",{attrs:{sm:"5"}},[a("CInput",{attrs:{label:"Nom du Client:",placeholder:"Select or add new Client"},model:{value:t.postData.clientName,callback:function(e){t.$set(t.postData,"clientName",e)},expression:"postData.clientName"}})],1):t._e(),"ressource"!==t.postData.type&&"memos"!==t.postData.type?a("CCol",{attrs:{sm:"5"}},[a("label",{staticClass:"typo__label"},[t._v("Exécuter par:")]),a("multiselect",{attrs:{options:t.users,placeholder:"Selectionnez un utilisateur",multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!1,searchable:!1,label:"name",loading:t.selectLoading,"track-by":"name","preselect-first":!1,"hide-selected":!0},on:{select:t.addExecutant,remove:t.deleteExecutant},model:{value:t.postData.executant,callback:function(e){t.$set(t.postData,"executant",e)},expression:"postData.executant"}})],1):t._e()],1),a("CRow",[a("CCol",{attrs:{sm:"12"}},[a("label",[t._v("Description:")]),a("ckeditor",{attrs:{config:t.editorConfig},on:{namespaceloaded:t.onNamespaceLoaded},model:{value:t.postData.text,callback:function(e){t.$set(t.postData,"text",e)},expression:"postData.text"}})],1)],1),"project"==t.postData.type?a("CRow",[a("CCol",{attrs:{col:"8",lg:"4"}},[a("CInput",{attrs:{label:"Estimation du coût:",append:".00",description:"montant",prepend:"$"},model:{value:t.postData.price,callback:function(e){t.$set(t.postData,"price",e)},expression:"postData.price"}})],1)],1):t._e()],1)])},r=[],n=a("d111"),s=a("25ae"),i=a.n(s),l=a("1487"),c=a.n(l),u=a("b8a6"),p=a("c1df"),d=a.n(p),f=a("f9cf"),h=a("8e5f"),m=a.n(h);function v(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,o)}return a}function b(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?v(Object(a),!0).forEach((function(e){g(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function g(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function _(t,e){var a="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=C(t))||e&&t&&"number"===typeof t.length){a&&(t=a);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,s=!0,i=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return s=t.done,t},e:function(t){i=!0,n=t},f:function(){try{s||null==a.return||a.return()}finally{if(i)throw n}}}}function C(t,e){if(t){if("string"===typeof t)return D(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?D(t,e):void 0}}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,o=new Array(e);a<e;a++)o[a]=t[a];return o}var y={name:"PopUpContent",props:{formValues:{type:[Object],required:!0},utilisateur:{type:[Array],required:!0},btnState:{type:Object,default:function(){return{state:!1}}},level:{type:Number,default:0}},components:{ckeditor:i.a.component,Multiselect:m.a},data:function(){return{selectLoading:!1,postData:{typeIsOk:!1,type:"project",status:"0",date_depart_proposer:"",date_fin_proposer:"",date_fin_reel:"",temps_pause:"",raison:"",heure_debut:"",heure_fin:"",clientName:"",titre:"",price:"",text:"",privaty:!0,executant:[]},fHeure:"",dHeure:"",wasValidated:null,showInputRaison:!1,editorData:"",warningModal:!1,extraPlugins:"",preEditorConfig:{codeSnippet_theme:"monokai_sublime",stylesSet:[],contentsCss:" @import '"+u["a"].baseUrl+"/modules/custom/gestion_tache/files/gestionTache.css'; body{margin:1em !important; background: #FFF;}",on:{instanceReady:function(t){t.sender.dataProcessor.writer.setRules("p",{indent:!0,breakBeforeOpen:!0,breakAfterOpen:!1,breakBeforeClose:!0,breakAfterClose:!0}),t.sender.dataProcessor.writer.setRules("img",{indent:!0,breakBeforeOpen:!0,breakAfterOpen:!1,breakBeforeClose:!1,breakAfterClose:!1}),t.sender.dataProcessor.writer.setRules("h1",{indent:!0,breakBeforeOpen:!1,breakAfterOpen:!1,breakBeforeClose:!1,breakAfterClose:!1}),t.sender.dataProcessor.writer.setRules("h2",{indent:!0,breakBeforeOpen:!1,breakAfterOpen:!1,breakBeforeClose:!1,breakAfterClose:!1}),t.sender.dataProcessor.writer.setRules("h3",{indent:!0,breakBeforeOpen:!1,breakAfterOpen:!1,breakBeforeClose:!1,breakAfterClose:!1}),t.sender.dataProcessor.writer.setRules("h4",{indent:!0,breakBeforeOpen:!1,breakAfterOpen:!1,breakBeforeClose:!1,breakAfterClose:!1}),t.sender.dataProcessor.writer.setRules("h5",{indent:!0,breakBeforeOpen:!1,breakAfterOpen:!1,breakBeforeClose:!1,breakAfterClose:!1}),t.sender.dataProcessor.writer.setRules("h6",{indent:!0,breakBeforeOpen:!1,breakAfterOpen:!1,breakBeforeClose:!1,breakAfterClose:!1}),t.sender.dataProcessor.writer.setRules("div",{indent:!0,breakBeforeOpen:!0,breakAfterOpen:!0,breakBeforeClose:!0,breakAfterClose:!1})}}},options:[],statusOpt:[{value:"0",label:"New"},{value:"2",label:"Encours"},{value:"1",label:"Terminé"},{value:"3",label:"Annulé"}]}},mounted:function(){var t=this;f["a"].loadType().then((function(e){t.options=e}))},watch:{formValues:{deep:!0,handler:function(t){console.log("val : ",t),n["a"].fomatVal(t,this.postData,this.users).then((function(){}))}}},computed:{users:function(){var t=[];if(this.utilisateur&&this.utilisateur.length){var e,a=_(this.utilisateur);try{for(a.s();!(e=a.n()).done;){var o=e.value,r={};r["uid"]=o["uid"][0]["value"],r["name"]=o["name"][0]["value"],r["mail"]=o["mail"][0]["value"],t.push(r)}}catch(n){a.e(n)}finally{a.f()}}return t},dureeProjet:function(){var t;return this.formValues.date_depart_proposer&&this.formValues.date_fin_proposer&&(t=this.formValues.date_fin_proposer-this.formValues.date_depart_proposer),t},tarara:function(){var t=this.postData.date_depart_proposer+" "+this.dHeure,e=d()(t,"YYYY-MM-DD HH:mm").unix(),a=d.a.unix(e).format("HH:mm"),o=[];return o.push(e),o.push(a),o},checkForSave:function(){return 1==this.wasValidated&&this.postData.type.length>2?(this.setBtnState(!0),!0):(this.setBtnState(!1),!1)},ser:function(){var t=document.createElement("div");return t.innerHTML=this.editorData,t.querySelectorAll("pre code").forEach((function(t){c.a.highlightBlock(t)})),t.outerHTML},editorConfig:function(){var t="codesnippet,print,format,font,colorbutton,justify,image,filebrowser,stylesheetparser";return window.location.host.includes("localhost--")?b({extraPlugins:t},this.preEditorConfig):b({extraPlugins:t+",quickuploader"},this.preEditorConfig)},optionsTache:function(){var t,e=[],a=_(this.options);try{for(a.s();!(t=a.n()).done;){var o=t.value;"project"==o.value||e.push(o)}}catch(r){a.e(r)}finally{a.f()}return e}},methods:{deleteExecutant:function(t){this.selectLoading=!0,console.log("user delet",t);var e=this;u["a"].delete("/gestion-project/executant/"+this.postData.idcontents+"/"+t.uid,{},{headers:{Authorization:u["a"].auth}}).then((function(a){a.status&&(e.updateFormValue(!1,t),e.selectLoading=!1)})).catch((function(t){e.selectLoading=!1,console.log("error",t)}))},updateFormValue:function(t,e){var a=this.formValues.executant;if(t)a.push(e);else{var o=a.filter((function(t){return t.uid==e.uid}));for(var r in console.log("existe",o),a)o[0].uid==a[r].uid&&a.splice(r,1)}},addExecutant:function(t){this.selectLoading=!0,console.log("user add",t,u["a"].auth);var e=this;u["a"].post("/gestion-project/executant/"+this.postData.idcontents+"/"+t.uid,{},{headers:{Authorization:u["a"].auth}}).then((function(a){a.status&&(e.selectLoading=!1,e.updateFormValue(!0,t))})).catch((function(t){e.selectLoading=!1,console.log("error",t)}))},onNamespaceLoaded:function(t){d.a,t.plugins.addExternal("quickuploader",u["a"].baseUrl+"/libraries/quickuploader/plugin.js?v="+d()().unix()),t.config.allowedContent=!0,t.config.htmlEncodeOutput=!1,t.config.entities=!1,t.config.quickuploaderUploadUrl=u["a"].baseUrl,t.dtd.$removeEmpty.span=0,t.dtd.$removeEmpty.i=0,t.dtd.$removeEmpty.label=0},setBtnState:function(t){this.btnState.state=t},inputValidation:function(t){return t.length<=4?(this.wasValidated=!1,!1):(this.wasValidated=!0,!0)},EventShowInput:function(){},TimeNow:function(){var t=d()().format("YYYY-MM-DD"),e=d()().format("HH:mm");this.postData.date_depart_proposer=t,this.postData.heure_debut=e,this.postData.date_fin_proposer=t,this.postData.heure_fin=e},changeType:function(){this.options=this.optionsTache,this.postData.type="tache"},EditProject:function(){var t=this,e=this;n["a"].formatData(this.postData,this.dHeure,this.fHeure).then((function(a){u["a"].post("/gestion-project/save-update",a,{headers:{Authorization:u["a"].auth}}).then((function(a){a.status&&e.$emit("edition-ok",a),t.isLoading=!1})).catch((function(t){e.$emit("edition-error"),console.log("error",t)}))}))},FormatTime:function(t){var e=this.postData,a=d()(e.date_depart_proposer,"YYYY-MM-DD  HH:mm").unix(),o=d()(e.date_fin_proposer,"YYYY-MM-DD  HH:mm").unix(),r=[];r.push({idcontents:t,date_depart_proposer:a,date_fin_proposer:o})},FormatData:function(t){var e=this.postData,a=d()(e.date_depart_proposer,"YYYY-MM-DD  HH:mm").unix(),o=d()(e.date_fin_proposer,"YYYY-MM-DD  HH:mm").unix(),r=parseInt(this.postData.status,10),n=[];return n.push({table:"gestion_project_contents",fields:{text:e.text,titre:e.titre,type:e.type},childstable:{colum_id_name:"idcontents",tables:[{table:"gestion_project_times",fields:{date_depart_proposer:a,date_fin_proposer:o,status:r}},{table:"gestion_project_hierachie",fields:{idcontentsparent:t,ordre:0}}]}}),n},PostNewProject:function(t){var e=this,a=this;n["a"].formatAddData(this.postData,t,this.level).then((function(t){console.log("created",t),u["a"].post("/gestion-project/save-update",t,{headers:{Authorization:u["a"].auth}}).then((function(t){t.status&&(a.request=t.data[0],a.$emit("addnew-ok")),e.isLoading=!1})).catch((function(t){a.$emit("addnew-error"),console.log("error",t)}))}))}}},k=y,w=a("2877"),j=Object(w["a"])(k,o,r,!1,null,"4f76eac5",null);e["default"]=j.exports},f0ae:function(t,e,a){"use strict";var o=a("b8a6"),r=o["a"].auth;e["a"]={selectDatas:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[{column:"c.type",operator:"=",value:"project"}];return new Promise((function(e){var a="";if(t.length)for(var n in t)a+=t[n].column+" "+t[n].operator+" '"+t[n].value+"' ";a+=" ORDER BY  c.`idcontents` DESC",a+=" limit 0,50 ",o["a"].post("/gestion-project/select/selectdatas",a,{headers:{Authorization:r}}).then((function(t){t.status?e(t.data):e([])}))}))},selectTypes:function(){return new Promise((function(t){o["a"].get("/gestion-project/select/project-type",{headers:{Authorization:r}}).then((function(e){e.status?t(e.data):t([])}))}))},selectProject:function(t){return new Promise((function(e){var a="";if(t.length)for(var n in t)a+=t[n].column+" "+t[n].operator+" '"+t[n].value+"' ";o["a"].post("/gestion-project/select/select-project",a,{headers:{Authorization:r}}).then((function(t){t.status?e(t.data):e([])}))}))},selectFatureList:function(t){var e=this;return new Promise((function(a){var n="";if(n+=" select * ",n+=" from ",n+=e.formatStringTable("gestion_project_invoice_list"),t.length)for(var s in n+=" WHERE ",t)n+=t[s].column+" "+t[s].operator+" '"+t[s].value+"' ";o["a"].post("/gestion-project/select",n,{headers:{Authorization:r}}).then((function(t){t.status?a(t.data):a([])}))}))},selectInvoice:function(t){var e=this;return new Promise((function(a){var n="";if(n+=" select * ",n+=" from ",n+=e.formatStringTable("gestion_project_invoice"),t.length)for(var s in n+=" WHERE ",t)n+=t[s].column+" "+t[s].operator+" '"+t[s].value+"' ";o["a"].post("/gestion-project/select",n,{headers:{Authorization:r}}).then((function(t){t.status?a(t.data):a([])}))}))},selectClients:function(t){var e=this;return new Promise((function(a){var n="";if(n+=" select * ",n+=" from ",n+=e.formatStringTable("gestion_project_client"),t.length)for(var s in n+=" WHERE ",t)n+=t[s].column+" "+t[s].operator+" '"+t[s].value+"' ";n+=" limit 0,50 ",o["a"].post("/gestion-project/select",n,{headers:{Authorization:r}}).then((function(t){t.status?a(t.data):a([])}))}))},selectSte:function(t){var e=this;return new Promise((function(a){var n="";if(n+=" select * ",n+=" from ",n+=e.formatStringTable("gestion_project_societe"),t.length)for(var s in n+=" WHERE ",t)n+=t[s].column+" "+t[s].operator+" '"+t[s].value+"' ";n+=" limit 0,50 ",o["a"].post("/gestion-project/select",n,{headers:{Authorization:r}}).then((function(t){t.status?a(t.data):a([])}))}))},selectClient:function(t){var e=this;return new Promise((function(a){var n="";n+=" select * ",n+=" from ",n+=e.formatStringTable(t),n+=" limit 0,50 ",o["a"].post("/gestion-project/select",n,{headers:{Authorization:r}}).then((function(t){t.status?a(t.data):a([])}))}))},selectAll:function(){return new Promise((function(t){var e="";e+=" c.idcontents is not NULL order by c.update_at DESC limit 0,30 ",o["a"].post("/gestion-project/select/select-project",e,{headers:{Authorization:r}}).then((function(e){e.status?t(e.data):t([])}))}))},SelectTacheEnours:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[{column:"t.status",operator:"=",value:2}];return new Promise((function(e,a){var n="";if(t.length)for(var s in t)n+=t[s].column+" "+t[s].operator+" '"+t[s].value+"' ";n+=" ORDER BY  c.`idcontents` DESC ",n+=" limit 0,20 ",o["a"].post("/gestion-project/select/select-tache-enours",n,{headers:{Authorization:r}}).then((function(t){t.status?e(t.data):e([])})).catch((function(t){a(t)}))}))},SelectMesTaches:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[{column:"t.uid",operator:"=",value:8}];return new Promise((function(a,n){var s="";if(e.length)for(var i in e)s+=e[i].column+" "+e[i].operator+" '"+e[i].value+"' ";s+=" ORDER BY  c.`idcontents` DESC ",s+=" limit 0,20 ",o["a"].post("/gestion-project/select/select-mes-taches/"+t,s,{headers:{Authorization:r}}).then((function(t){t.status?a(t.data):a([])})).catch((function(t){n(t)}))}))},formatStringTable:function(t){return"{"+t+"}"}}},f9cf:function(t,e,a){"use strict";var o=a("f0ae"),r={opts:[],instance:!1,loadType:function(){var t=this;return new Promise((function(e){t.instance?t.instance.then((function(){e(t.opts)})):t.opts.length||(t.instance=o["a"].selectTypes(),t.instance.then((function(a){var o=[];for(var r in a)o.push({value:a[r].name,label:a[r].label,description:a[r].description});t.opts=o,e(t.opts)})))}))}};e["a"]=r}}]);
//# sourceMappingURL=gestionTache.umd.min.2.js.map